<div class="gds-selectbox">
  <!-- Label -->
  <gds-label
    [for]="id"
    [size]="size"
    [required]="required"
    [disabled]="disabled"
    [error]="error"
    *ngIf="label"
  >
    {{ label }}
  </gds-label>

  <!-- Select Input -->
  <div
    class="gds-selectbox__control"
    [class.gds-selectbox__control--open]="isOpen"
    [class.gds-selectbox__control--error]="error"
    [class.gds-selectbox__control--disabled]="disabled"
    [class.gds-selectbox__control--sm]="size === 'sm'"
    [class.gds-selectbox__control--md]="size === 'md'"
    [class.gds-selectbox__control--lg]="size === 'lg'"
  >
    <input
      [id]="id"
      type="text"
      class="gds-selectbox__input"
      [placeholder]="placeholder"
      [disabled]="disabled"
      [value]="searchTerm"
      (input)="onSearchInput($event)"
      (focus)="onFocus()"
      (blur)="onBlur()"
      autocomplete="off"
    />
    <button
      type="button"
      class="gds-selectbox__clear"
      *ngIf="selectedValue !== null && !disabled"
      (click)="clearSelection()"
      tabindex="-1"
      title="Limpar seleção"
    >
      <svg
        class="gds-selectbox__clear-icon"
        width="16"
        height="16"
        viewBox="0 0 16 16"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" />
        <path
          d="M10.5 5.5L5.5 10.5M5.5 5.5L10.5 10.5"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
        />
      </svg>
    </button>
    <button
      type="button"
      class="gds-selectbox__toggle"
      [disabled]="disabled"
      (click)="toggleDropdown()"
      tabindex="-1"
    >
      <svg
        class="gds-selectbox__icon"
        [class.gds-selectbox__icon--open]="isOpen"
        width="20"
        height="20"
        viewBox="0 0 20 20"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M5 7.5L10 12.5L15 7.5"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>
  </div>

  <!-- Dropdown -->
  <div class="gds-selectbox__dropdown" *ngIf="isOpen">
    <div class="gds-selectbox__options">
      <div
        *ngFor="let option of filteredOptions"
        class="gds-selectbox__option"
        [class.gds-selectbox__option--selected]="option.value === selectedValue"
        (click)="selectOption(option)"
      >
        {{ option.display }}
      </div>
      <div
        *ngIf="filteredOptions.length === 0"
        class="gds-selectbox__option gds-selectbox__option--empty"
      >
        Nenhum resultado encontrado
      </div>
    </div>
  </div>

  <!-- Helper Text / Error Message -->
  <div
    *ngIf="helperText || errorMessage"
    [id]="id + '-description'"
    class="gds-selectbox__description"
    [class.gds-selectbox__description--error]="error && errorMessage"
  >
    {{ error && errorMessage ? errorMessage : helperText }}
  </div>
</div>
